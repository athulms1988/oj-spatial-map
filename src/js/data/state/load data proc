create or replace procedure eba_sample_map_org_load_data(
    p_load_from       in varchar2,
    p_org_file_name   in varchar2 )
is
    l_org_json   blob;
begin
    if p_load_from = 'FILE' then
        if p_org_file_name is not null then
            select blob_content
              into l_org_json
              from apex_application_temp_files
             where name = p_org_file_name;
        end if;
    end if;

    if l_org_json is not null then
        delete from eba_sample_map_organizations;

        insert into eba_sample_map_organizations (id, name, status, customer_status, address_type, country, state, city, street, postal, add_details , geometry )
        ( 
            select id, name, status, customer_status, address_type, country, state, city, street, postal, add_details , geometry
              from json_table(
                       l_org_json format json,
                       '$[*]'
                       columns (
                                 id               number             path '$.id',
                                 name             varchar2(255)      path '$.name',
                                 status           varchar2(255)      path '$.status',
                                 customer_status  varchar2(255)      path '$.customerStatus',
                                 address_type     varchar2(255)      path '$.addressType',
                                 country          varchar2(255)      path '$.country',
                                 state            varchar2(255)      path '$.state',
                                 city             varchar2(255)      path '$.city',
                                 street           varchar2(255)      path '$.street',
                                 postal           varchar2(255)      path '$.postal',
                                 add_details      varchar2(255)      path '$.add_details',
                                 geometry         mdsys.sdo_geometry path '$.geometry' ) ) );

    end if;
end;
/
